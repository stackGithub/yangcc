<template>  <vue-easy-print tableShow ref="easyPrint" >    <div id="printModel" class="c_p_n c_box c_auto_y">      <h2 class="c_center">{{ headerTableSelectionData.purpose }}</h2>      <!--其他信息-->      <div class="c_m_t_n c_flex c_flex_between">        <div>部门： {{headerTableSelectionData.deptname}}</div>        <div>单据编号： {{headerTableSelectionData.vbillno}}</div>        <div>单据日期： {{headerTableSelectionData.dbilldate}}</div>        <div>单位：元</div>      </div>      <!--表体-->      <div class="c_m_t_n">        <el-card class="box-card">          <div slot="header" class="clearfix">            <span>收款人信息</span>          </div>          <el-table size="small" border show-summary :summary-method="getSummaries_sk" :data="tableBodyData.sk">            <template v-for="(item, i) in tableBodyParam.list_sk">              <el-table-column v-if="item.key === 'rowno'" :key="i" :width="item.width" :label="item.name" :prop="item.key">                <template slot-scope="scope">                  {{ scope.$index + 1}}                </template>              </el-table-column>              <el-table-column v-else :key="i" :width="item.width" :label="item.name" :prop="item.key"></el-table-column>            </template>          </el-table>        </el-card>        <el-card class="box-card c_m_t_n">          <div slot="header" class="clearfix">            <span>费用明细</span>          </div>          <el-table size="small" border show-summary :summary-method="getSummaries_fy" :data="tableBodyData.fy">            <template v-for="(item, i) in tableBodyParam.list_fy">              <el-table-column v-if="item.key === 'rowno'" :key="i" :width="item.width" :label="item.name" :prop="item.key">                <template slot-scope="scope">                  {{ scope.$index + 1}}                </template>              </el-table-column>              <template v-else-if="item.isTitle">                <el-table-column :label="item.name" align="center">                  <template v-for="(subItem, sub) in item.children">                    <el-table-column :key="i + '-' + sub" :width="subItem.width" :label="subItem.name" :prop="subItem.key"></el-table-column>                  </template>                </el-table-column>              </template>              <el-table-column v-else :key="i" :width="item.width" :label="item.name" :prop="item.key"></el-table-column>            </template>          </el-table>        </el-card>      </div>      <!--其他信息-->      <div class="c_m_t_n c_flex c_flex_between">        <div>部门负责人： </div>        <div>财务审核人： </div>        <div>财务负责人： </div>        <div>分管副院长： </div>        <div>院长： </div>        <div>经办人： <pre>                              </pre></div>      </div>    </div>  </vue-easy-print></template><script>  import vueEasyPrint from "vue-easy-print";  export default {    name: "printTravelExpenses",    components: { vueEasyPrint },    data() {      return {        visible: true,        // 表体参数        // -- 表格参数        tableBodyParam: {          list: [            //序号	姓名	银行卡号	开户行	联行号	应发	税率	税额	实发	备注 人员档案主键	人员银行账户主键            { name: '序号', key: 'rowno', isUse: true },            { name: '姓名', key: 'name', isUse: true },            { name: '职称', key: 'def2', isUse: true },            { name: '单位名称', key: 'def3', isUse: true },            { name: '项目', key: 'def4name', isUse: true },            { name: '身份证', key: 'idcard', width: 140, isUse: true },            { name: '银行卡号', key: 'banknum', width: 130, isUse: true },            { name: '开户行', key: 'crtbank', width: 260, isUse: true },            { name: '联行号', key: 'combinenum', width: 120, isUse: true },            { name: '手机号', key: 'def5', width: 120, isUse: true },            { name: '应发', key: 'should', width: 100, isUse: true },            { name: '税额', key: 'ntax', width: 100, isUse: true },            { name: '实发', key: 'reality', width: 100, isUse: true },            { name: '工作内容及工作量', key: 'def6', width: 200, isUse: true },            { name: '备注', key: 'memo', width: 200, isUse: true },          ],          // 收款人信息: sk          list_sk: [            { name: '收款人', key: 'skrname', isUse: true },            { name: '部门', key: 'bmname', isUse: true },            { name: '银行账号', key: 'yhzhname', isUse: true },            { name: '金额(元)', key: 'je', isUse: true },            { name: '备注', key: 'skbz', isUse: true }          ],          // 费用明细: fy          list_fy: [            { name: '出差日期', key: 'ccrq', width: 100, isUse: true },            { name: '出发地点', key: 'cfdd', isUse: true },            { name: '到达地点', key: 'dddd', isUse: true },            { name: '交通工具', key: 'jtgj', isUse: true },            { name: '出差天数', key: 'ccts', isUse: true },            { name: '交通费用', isTitle: true, children: [                { name: '城市间交通费(元)', key: 'jtf', width: 100, isUse: true },                { name: '税率(%)', key: 'jtsl', isUse: true },                { name: '税额(元)', key: 'jtse', width: 100, isUse: true }              ]            },            { name: '住宿费用', isTitle: true, children: [                { name: '住宿费(元)', key: 'zsf', width: 100, isUse: true },                { name: '税率(%)', key: 'zssl', isUse: true },                { name: '税额(元)', key: 'zsse', width: 100, isUse: true }              ]            },            { name: '补贴', isTitle: true, children: [                { name: '市内交通费(元)', key: 'snjtf', width: 100, isUse: true },                { name: '伙食补助(元)', key: 'hsbz', isUse: true }              ]            },            { name: '其他费用', isTitle: true, children: [                { name: '金额(元)', key: 'qtje', width: 100, isUse: true },                { name: '税率(%)', key: 'qtsl', isUse: true },                { name: '税额(元)', key: 'qtse', width: 100, isUse: true },              ]            },            { name: '报销金额(元)', key: 'bxje', width: 100, isUse: true },            { name: '备注', key: 'fymemo', isUse: true }          ]        },        headerTableSelectionData: {},        // -- 表格列表数据        tableBodyData: {          // 收款人信息          sk: [],          // 费用明细          fy: []        },      }    },    created() {      // this.tableBodyData = JSON.parse(this.$route.query.tableBodyData);      // this.headerTableSelectionData = JSON.parse(this.$route.query.headerTableSelectionData);      let tableBodyData = sessionStorage['tableBodyData']      let headerTableSelectionData = sessionStorage['headerTableSelectionData']      this.tableBodyData = JSON.parse(tableBodyData);      this.headerTableSelectionData = JSON.parse(headerTableSelectionData);    },    mounted() {      // window.print();//调用打印的窗口      this.printView()    },    methods: {      open(tableBodyData, headerTableSelectionData) {        this.tableBodyData = tableBodyData;        this.headerTableSelectionData = headerTableSelectionData;        this.visible = true      },      cancel() {        this.tableBodyData = [];        this.headerTableSelectionData = {};        this.visible = false      },      // 表体合计: sk：收款人信息， fy：费用      getSummaries_sk(param) {        const { columns, data } = param;        const sums = [];        columns.forEach((column, index) => {          if (index === 0) {            sums[index] = '合计';            return;          }          if (![3].includes(index)) {            return;          }          const values = data.map(item => Number(item[column.property]));          if (!values.every(value => isNaN(value))) {            sums[index] = values.reduce((prev, curr) => {              const value = Number(curr);              if (!isNaN(value)) {                return prev + curr;              } else {                return prev;              }            }, 0);            sums[index] = +(sums[index].toFixed(2))            sums[index] += ' 元';          } else {            sums[index] = '';          }        });        return sums;      },      getSummaries_fy(param) {        const { columns, data } = param;        const sums = [];        columns.forEach((column, index) => {          if (index === 0) {            sums[index] = '合计';            return;          }          if (![5, 7, 8, 10, 11, 12, 13, 15, 16, 17].includes(index)) {            return;          }          const values = data.map(item => Number(item[column.property]));          if (!values.every(value => isNaN(value))) {            sums[index] = values.reduce((prev, curr) => {              const value = Number(curr);              if (!isNaN(value)) {                return prev + curr;              } else {                return prev;              }            }, 0);            sums[index] = +(sums[index].toFixed(4))            sums[index] += ' 元';          } else {            sums[index] = '';          }        });        return sums;      },      // 打印      printView() {        this.$nextTick(() => {          this.$refs.easyPrint.print()        })      }    }  }</script><style scoped></style>