<template>  <!--报销部门选择框-->  <el-dialog    title="部门档案"    :modal-append-to-body="false"    :append-to-body="false"    :visible.sync="param.visible"  >    <div class="c_flex c_flex_between c_auto_y c_flex_center c_hidden" style="height: 300px;">      <!--show-checkbox-->      <div class="c_h">        <el-tree          :data="param.data"          node-key="pk_deptdoc"          ref="tree"          accordion          getHalfCheckedKeys          highlight-current          :props="param.defaultProps"          :load="loadNode"          lazy          @node-click="handleTreeClick"        >            <span class="custom-tree-node" slot-scope="{ node, data }">              {{ data.deptname }}            </span>        </el-tree>      </div>      <el-divider direction="vertical" style="height: 100%;" class="c_h c_m_l_10 c_m_r_10"></el-divider>    </div>    <span slot="footer" class="dialog-footer">        <el-button size="small" @click="cancel">取 消</el-button>        <el-button type="primary" size="small" @click="confirmTree">确 定</el-button>      </span>  </el-dialog></template><script>  export default {    name: "bxbmSelect",    data() {      return {        api: '',        // 部门选择参数        param: {          visible: false,          defaultProps: {            children: 'children',            label: 'deptname',            key: 'pk_deptdoc'          },          data: [],          // 选中tree数据          selectData: {}        }      }    },    methods: {      // 项目树操作      open(api) {        this.api = api        // this.getBmList()        this.param.visible = true      },      cancel() {        this.param.selectData = {}        this.param.visible = false      },      // 获取部门列表      getBmList() {        let data = {          action: 'dept',          data: {            pk_fathedept: '0'          }        }        data.data = JSON.stringify(data.data)        this.$ajax.postform(this.api, data, res => {          if (this.judgeValue(res)) {            this.param.data = res.data || []          }        })      },      loadNode(node, resolve) {        let data = {          action: 'dept',          data: {            pk_fathedept: node.data.pk_deptdoc || "0"          }        }        data.data = JSON.stringify(data.data)        this.$ajax.postform(this.api, data, res => {          if (this.judgeValue(res)) {            let list = (res.data || []).map(item => {              item.leaf = item.children > 0              return item            })            resolve(list)          }        })      },      // 部门树点击事件      handleTreeClick(data) {        // deptcode: "00801"        // deptname: "条件保障部公共"        // pk_deptdoc: "1004F810000000002V1X"        let { pk_deptdoc, deptname, children } = data        if (children > 0) {          pk_deptdoc = ''          deptname = ''        }        this.param.selectData = { pk_deptdoc, deptname, children }      },      // -- 项目树提交      confirmTree() {        // 部门        // deptcode: "00801"        // deptname: "条件保障部公共"        // pk_deptdoc: "1004F810000000002V1X"        if (this.param.selectData.children > 0) {          return this.$message({ type: 'warn', message: '请选择最后一级部门', duration: 1000 })        }        if (!this.param.selectData || !this.param.selectData.pk_deptdoc) {          return this.$message({ type: 'warn', message: '请选择报销部门', duration: 1000 })        }        let data = {          bxbmname: this.param.selectData.deptname,          bxbm: this.param.selectData.pk_deptdoc,        };        this.$emit('confirm', data)        this.cancel();      },      // 返回值判断      judgeValue(res, callback) {        if (res.success === 'Y') {          return true        } else {          this.$message({ type: 'warn', message: res.message, duration: 1000 })          return false        }      },    }  }</script><style scoped></style>