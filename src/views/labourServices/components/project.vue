<template>  <!--项目选择框-->  <el-dialog    title="项目"    :modal-append-to-body="false"    :append-to-body="false"    :visible.sync="projectParam.visible"  >    <div class="c_flex c_flex_between c_auto_y c_hidden" style="height: 300px;">      <!--show-checkbox-->      <div class="c_auto c_h" style="min-width: 230px;">        <el-tree          :data="projectParam.data"          node-key="JOBCLASS"          ref="tree"          accordion          getHalfCheckedKeys          highlight-current          :props="projectParam.defaultProps"          @node-click="handleTreeClick"        >            <span class="custom-tree-node" slot-scope="{ node, data }">              {{ data.JOBCLASS + '-' + data.JOBNAME}}            </span>        </el-tree>      </div>      <el-divider direction="vertical" style="height: 100%;" class="c_h c_m_l_10 c_m_r_10"></el-divider>      <div class="c_flex_1 c_hidden">        <el-form label-position="left" inline class="demo-table-expand">          <template v-for="(item,i) in projectParam.selectTableSearchList">            <el-form-item :label="item.name">              <el-input size="small" v-model="projectParam.selectTableSearchData[item.key]"></el-input>            </el-form-item>          </template>          <el-form-item>            <el-button type="primary" size="small" @click="getTreeDetailList">搜索</el-button>          </el-form-item>        </el-form>        <el-table          class="c_h"          size="small"          height="250"          :highlight-current-row="true"          :data="projectParam.detailData"          @row-click="projectTableClick"        >          <template v-for="(item, i) in projectParam.detailList">            <el-table-column :key="i" :label="item.name" :prop="item.key"></el-table-column>          </template>        </el-table>      </div>    </div>    <span slot="footer" class="dialog-footer">        <el-button size="small" @click="cancel">取 消</el-button>        <el-button type="primary" size="small" @click="confirmTree">确 定</el-button>      </span>  </el-dialog></template><script>  const json_project = require('../../../../static/json/labourService/project')  export default {    name: "project",    data() {      return {        api: '',        // 项目选择参数        projectParam: {          visible: false,          defaultProps: {            children: 'children',            label: 'JOBNAME'          },          data: json_project,          // -- 详情表格参数          detailList: [            // {jobcode: "05"            //   jobname: "05"            //   pk_job}            { name: '项目编码', key: 'jobcode', isUse: true },            { name: '项目名称', key: 'jobname', isUse: true },            // { name: '组件', key: 'pk_job', isUse: true },          ],          // -- 详情表格数据          detailData: [],          // -- 选中tree数据          selectTreeData: {},          // 选中tree 下筛选条件参数          selectTableSearchList: [            { name: '项目名称', key: 'jobname', isUse: true },          ],          // 选中tree 下筛选数据          selectTableSearchData: {},          // -- 选中tree 下部门数据          selectTableData: {}        }      }    },    methods: {      // 项目树操作      open(api) {        this.api = api        this.projectParam.visible = true      },      cancel() {        this.projectParam.selectTableData = {}        this.projectParam.visible = false      },      // 项目树点击事件      handleTreeClick(data) {        let { JOBCLASS, JOBCODE, JOBNAME } = data        if (!data.children || !data.children.length) {          // 返回参数`          this.projectParam.selectData = { JOBCLASS, JOBCODE, JOBNAME }          this.getTreeDetailList()        } else {          this.projectParam.selectData = {}        }      },      // 获取项目树 下部门      getTreeDetailList() {        let { JOBCODE, JOBCLASS } = this.projectParam.selectData        let { jobname } = this.projectParam.selectTableSearchData        if (!JOBCLASS) {          return this.$message({ type: 'warn', message: '请选择到最后一级,以提高搜索效率', duration: 1000 })        }        let data = {          action: 'proj',          data: {            pk_jobclass: JOBCLASS,            jobcode: JOBCODE,            jobname          }        }        data.data = JSON.stringify(data.data)        this.$ajax.postform(this.api, data, res => {          if (this.judgeValue(res)) {            this.projectParam.detailData = res.data || []          }        })      },      projectTableClick(row) {        this.projectParam.selectTableData = row      },      // -- 项目树提交      confirmTree() {        // const list = this.$refs.tree.getCheckedNodes()        // this.headerTableSelectionData.project = list[i].JOBCODE        if (!this.projectParam.selectTableData || !this.projectParam.selectTableData.jobcode) {          return this.$message({ type: 'warn', message: '请选择项目', duration: 1000 })        }        let data = {          jobname: this.projectParam.selectTableData.jobname,          pk_job: this.projectParam.selectTableData.pk_job        };        this.cancel();        this.$emit('confirm', data)      },      // 返回值判断      judgeValue(res, callback) {        if (res.success === 'Y') {          return true        } else {          this.$message({ type: 'warn', message: res.message, duration: 1000 })          return false        }      },    }  }</script><style scoped></style>