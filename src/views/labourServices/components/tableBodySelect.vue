<template>  <div>  <!--查询-->  <el-dialog    title="报销单"    :modal-append-to-body="false"    :append-to-body="false"    :visible.sync="param.visible"  >    <el-form :rules="rules" label-position="left" inline class="demo-table-expand">      <template v-for="(item,i) in param.list">        <template v-if="item.key==='crtbank'">          <el-form-item :prop="item.key" :label="item.name">            <el-input size="small" style="width: 500px" :placeholder="item.tips" v-model="queryData[item.key]"></el-input>          </el-form-item>        </template>        <template v-else-if="item.type === 'textarea'">          <el-form-item :prop="item.key" :label="item.name">            <el-input              style="width: 300px"              type="textarea"              :rows="3"              :placeholder="item.tips"              v-model="queryData[item.key]">            </el-input>          </el-form-item>        </template>        <template v-else-if="item.type === 'bank'">          <el-form-item :prop="item.key" :label="item.name">            <el-input              size="small"              :placeholder="item.tips"              v-model.number="queryData[item.key]"              @input="handleBankNum"            >            </el-input>          </el-form-item>        </template>        <template v-else-if="item.type === 'project'">          <el-form-item :prop="item.key" :label="item.name">            <el-input              size="small"              readonly              suffix-icon="el-icon-search"              :placeholder="item.tips"              v-model="queryData[item.key]"              v-on:click.native="handleTree"></el-input>          </el-form-item>        </template>        <template v-else-if="item.type === 'number'">          <el-form-item :prop="item.key" :label="item.name">            <el-input size="small" :placeholder="item.tips" v-model="queryData[item.key]"></el-input>          </el-form-item>        </template>        <template v-else>          <el-form-item :prop="item.key" :label="item.name">            <el-input size="small" :placeholder="item.tips" v-model="queryData[item.key]"></el-input>          </el-form-item>        </template>      </template>    </el-form>    <span slot="footer" class="dialog-footer">        <el-button size="small" @click="close">取 消</el-button>        <el-button type="primary" size="small" @click="confirmSelect">确 定</el-button>      </span>  </el-dialog>    <!--项目选择-->    <project-select ref="projectSelect" @confirm="confirmTree"></project-select>  </div></template><script>  import projectSelect from './project'  export default {    name: "tableBodySelect",    components: { projectSelect },    data() {      return {        api: '',        param: {          visible: false,          type: 'add',          index: 0,          list: [            { name: '姓名', key: 'name', type: 'text', tips: '请输入姓名' },            { name: '职称', key: 'def2', type: 'text', tips: '请输入职称' },            { name: '单位名称', key: 'def3', type: 'text', tips: '请输入单位名称' },            { name: '项目', key: 'def4name', type: 'project', tips: '请选择项目' },            { name: '身份证', key: 'idcard', type: 'text', tips: '请输入身份证' },            { name: '联行号', key: 'combinenum', type: 'text', tips: '请输入联行号' },            { name: '银行卡号', key: 'banknum', type: 'bank', tips: '请输入银行卡号' },            { name: '开户行', key: 'crtbank', type: 'text', tips: '请输入开户行' },            { name: '手机号', key: 'def5', type: 'number', tips: '请输入手机号' },            { name: '应发', key: 'should', type: 'number', tips: '请输入应发金额' },            { name: '税额', key: 'ntax', type: 'number', tips: '请输入税额' },            { name: '实发', key: 'reality', type: 'number', tips: '请输入实发金额' },            { name: '工作内容及工作量', key: 'def6', type: 'textarea', tips: '请输入工作内容及工作量' },            { name: '备注', key: 'memo', type: 'textarea', tips: '请输入备注' }          ]        },        rules: {          idcard: [            { validator: this.validateIdcard, trigger: 'blur' }          ],        },        dataSource: {          idCardReg: /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/        },        queryData: {        }      }    },    watch: {      "queryData.should"(val) {        let should = +this.queryData.should || 0        let ntax = +this.queryData.ntax || 0        let result = ((should*100 - ntax*100)/100).toFixed(2)        this.queryData.reality = +result      },      "queryData.ntax"(val) {        let should = +this.queryData.should || 0        let ntax = +this.queryData.ntax || 0        let result = ((should*100 - ntax*100)/100).toFixed(2)        this.queryData.reality = +result      }    },    methods: {      open(type, api, row, index) {        this.api = api        this.type = type        this.index = index        this.queryData = row || {}        if (this.queryData.banknum) {          this.queryData.banknum =  String(this.queryData.banknum).replace(/\s/g, '');        }        this.param.visible = true      },      close() {        this.queryData = {}        this.param.visible = false      },      confirmSelect() {        let obj = this.$util.deepCopy(this.queryData);        if (obj.banknum) {          obj.banknum =  obj.banknum.replace(/\s/g, '');        }        if (!obj.name) {          return this.$message({ message: '请填写姓名', duration: 1000 })        }        if (!obj.idcard || (!this.dataSource.idCardReg.test(obj.idcard))) {          return this.$message({ message: '请填写身份证', duration: 1000 })        }        if (!obj.banknum) {          return this.$message({ message: '请填写银行卡号', duration: 1000 })        }        if (!obj.crtbank) {          return this.$message({ message: '请填写开户行', duration: 1000 })        }        if (!obj.combinenum) {          return this.$message({ message: '请填写联行号', duration: 1000 })        }        if (!obj.should) {          return this.$message({ message: '请填写应发', duration: 1000 })        }        if (!obj.ntax) {          return this.$message({ message: '请填写税额', duration: 1000 })        }        if (!obj.reality) {          return this.$message({ message: '请填写实发', duration: 1000 })        }        this.$emit('confirm', this.type, obj, this.index)        this.close()      },      // 银行卡号展示格式      handleBankNum(value) {        let nospace = value.replace(/\s/g, '');        let result = nospace.replace(/(\d{4})/g, "$1 ").trim()        this.queryData.banknum = result      },      // rules      validateIdcard(rule, value, callback) {        value = this.queryData.idcard        const reg = this.dataSource.idCardReg        if (value === '') {          callback(new Error('请输入身份证'));        } else if(!reg.test(value)){          callback(new Error('请输入正确的身份证'));        } else {          callback();        }      },      // 选择项目      handleTree() {        this.$refs.projectSelect.open(this.api)      },      //  项目 def4 提交      confirmTree(data) {        this.queryData = {          ...this.queryData,          def4name: data.jobname,          def4: data.pk_job        }      }    }  }</script><style scoped></style>